<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="author" content="">
<meta name="description" content="ä¸çŸ¥é“å…¶ä»–äººæ˜¯ä¸æ˜¯è¿™æ ·ï¼Œåæ­£è€è®¸æœ€æ€•å¬åˆ°çš„è¯å°±æ˜¯â€œå¶ç°â€ï¼Œè‡³äºåŸå› æˆ‘ä¸å¤šè¯´ï¼Œæ‡‚çš„éƒ½æ‡‚ã€‚
ä¸‹é¢ç›´æ¥çœ‹panicä¿¡æ¯ã€‚
runtime error: invalid memory address or nil pointer dereference panic(0xbd1c80, 0x1271710) /root/.go/src/runtime/panic.go:969 &#43;0x175 github.com/json-iterator/go.(*Stream).WriteStringWithHTMLEscaped(0xc00b0c6000, 0x0, 0x24) /go/pkg/mod/github.com/json-iterator/go@v1.1.11/stream_str.go:227 &#43;0x7b github.com/json-iterator/go.(*htmlEscapedStringEncoder).Encode(0x12b9250, 0xc0096c4c00, 0xc00b0c6000) /go/pkg/mod/github.com/json-iterator/go@v1.1.11/config.go:263 &#43;0x45 github.com/json-iterator/go.(*structFieldEncoder).Encode(0xc002e9c8d0, 0xc0096c4c00, 0xc00b0c6000) /go/pkg/mod/github.com/json-iterator/go@v1.1.11/reflect_struct_encoder.go:110 &#43;0x78 github.com/json-iterator/go.(*structEncoder).Encode(0xc002e9c9c0, 0xc0096c4c00, 0xc00b0c6000) /go/pkg/mod/github.com/json-iterator/go@v1.1.11/reflect_struct_encoder.go:158 &#43;0x3f4 github.com/json-iterator/go.(*structFieldEncoder).Encode(0xc002eac990, 0xc0096c4c00, 0xc00b0c6000) /go/pkg/mod/github.com/json-iterator/go@v1.1.11/reflect_struct_encoder.go:110 &#43;0x78 github.com/json-iterator/go.(*structEncoder).Encode(0xc002eacba0, 0xc0096c4c00, 0xc00b0c6000) /go/pkg/mod/github.com/json-iterator/go@v1.1.11/reflect_struct_encoder.go:158 &#43;0x3f4 github.com/json-iterator/go.(*OptionalEncoder).Encode(0xc002e9f570, 0xc006b18b38, 0xc00b0c6000) /go/pkg/mod/github.com/json-iterator/go@v1.1.11/reflect_optional.go:70 &#43;0xf4 github.com/json-iterator/go.(*onePtrEncoder).Encode(0xc002e9f580, 0xc0096c4c00, 0xc00b0c6000) /go/pkg/mod/github.com/json-iterator/go@v1.1.11/reflect.go:219 &#43;0x68 github.com/json-iterator/go.(*Stream).WriteVal(0xc00b0c6000, 0xb78d60, 0xc0096c4c00) /go/pkg/mod/github.com/json-iterator/go@v1.1.11/reflect.go:98 &#43;0x150 github.com/json-iterator/go.(*frozenConfig).Marshal(0xc00012c640, 0xb78d60, 0xc0096c4c00, 0x0, 0x0, 0x0, 0x0, 0x0) é¦–å…ˆæˆ‘åšä¿¡ä¸€æ¡ï¼Œå¼€æºçš„åŠ›é‡å€¼å¾—ä¿¡èµ–ã€‚å› æ­¤è€è®¸ç¬¬ä¸€æ³¢æ“ä½œå°±æ˜¯ï¼Œåˆ†æä¸šåŠ¡ä»£ç æ˜¯å¦æœ‰é€»è¾‘æ¼æ´ã€‚å¾ˆæ˜æ˜¾ï¼ŒåŒäº‹ä¹Ÿæ˜¯å€¼å¾—ä¿¡èµ–çš„ï¼Œå› æ­¤æœæ–­çŒœæµ‹æ˜¯æŸäº›æœªæ›¾è®¾æƒ³åˆ°çš„æ•°æ®è§¦å‘äº†è¾¹ç•Œæ¡ä»¶ã€‚æ¥ä¸‹æ¥å°±æ˜¯ä¿å­˜ç°åœºçš„å¸¸è§„æ“ä½œã€‚
å¦‚æ ‡é¢˜æ‰€è¯´ï¼Œè¿™æ˜¯å¶ç°çš„panicé—®é¢˜ï¼Œå› æ­¤æŒ‰ç…§ä¸Šé¢çš„åˆ†ç±»é‡‡ç”¨ç¬¦åˆå½“å‰æŠ€æœ¯æ ˆçš„æ–¹æ³•ä¿å­˜ç°åœºå³å¯ã€‚æ¥ä¸‹æ¥å°±æ˜¯åç­‰æ”¶è·çš„å­£èŠ‚ï¼Œè€Œè¿™ä¸€ç­‰å°±æ˜¯å¥½å¤šå¤©ã€‚ä¸­é—´æ•°æ¬¡æ”¶åˆ°å‘Šè­¦ï¼Œå´æ²¡æœ‰ç¬¦åˆé¢„æœŸçš„ç°åœºã€‚" />
<meta name="keywords" content=", Go" />
<meta name="robots" content="noodp" />
<meta name="theme-color" content="" />
<link rel="canonical" href="https://isites.gitlab.io/gopher/timeline/defer-sync-pool/" />


    <title>
        
            ç»ˆäºè§£å†³äº†è¿™ä¸ªçº¿ä¸Šå¶ç°çš„panicé—®é¢˜ :: GopheræŒ‡åŒ— 
        
    </title>



<link href="https://cdnjs.cloudflare.com/ajax/libs/flag-icon-css/3.2.1/css/flag-icon.min.css" rel="stylesheet"
    type="text/css"> 




<link rel="stylesheet" href="/gopher/main.805b1025016494ee5fd67b55b8ecd5e2b7c4a9f0bdda42e300c62b85ddfef68f.css">


  

    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#252627">
    <link rel="shortcut icon" href="/favicon.ico">
    <meta name="msapplication-TileColor" content="#252627">
    <meta name="theme-color" content="#252627">



<meta itemprop="name" content="ç»ˆäºè§£å†³äº†è¿™ä¸ªçº¿ä¸Šå¶ç°çš„panicé—®é¢˜">
<meta itemprop="description" content="ä¸çŸ¥é“å…¶ä»–äººæ˜¯ä¸æ˜¯è¿™æ ·ï¼Œåæ­£è€è®¸æœ€æ€•å¬åˆ°çš„è¯å°±æ˜¯â€œå¶ç°â€ï¼Œè‡³äºåŸå› æˆ‘ä¸å¤šè¯´ï¼Œæ‡‚çš„éƒ½æ‡‚ã€‚
ä¸‹é¢ç›´æ¥çœ‹panicä¿¡æ¯ã€‚
runtime error: invalid memory address or nil pointer dereference panic(0xbd1c80, 0x1271710) /root/.go/src/runtime/panic.go:969 &#43;0x175 github.com/json-iterator/go.(*Stream).WriteStringWithHTMLEscaped(0xc00b0c6000, 0x0, 0x24) /go/pkg/mod/github.com/json-iterator/go@v1.1.11/stream_str.go:227 &#43;0x7b github.com/json-iterator/go.(*htmlEscapedStringEncoder).Encode(0x12b9250, 0xc0096c4c00, 0xc00b0c6000) /go/pkg/mod/github.com/json-iterator/go@v1.1.11/config.go:263 &#43;0x45 github.com/json-iterator/go.(*structFieldEncoder).Encode(0xc002e9c8d0, 0xc0096c4c00, 0xc00b0c6000) /go/pkg/mod/github.com/json-iterator/go@v1.1.11/reflect_struct_encoder.go:110 &#43;0x78 github.com/json-iterator/go.(*structEncoder).Encode(0xc002e9c9c0, 0xc0096c4c00, 0xc00b0c6000) /go/pkg/mod/github.com/json-iterator/go@v1.1.11/reflect_struct_encoder.go:158 &#43;0x3f4 github.com/json-iterator/go.(*structFieldEncoder).Encode(0xc002eac990, 0xc0096c4c00, 0xc00b0c6000) /go/pkg/mod/github.com/json-iterator/go@v1.1.11/reflect_struct_encoder.go:110 &#43;0x78 github.com/json-iterator/go.(*structEncoder).Encode(0xc002eacba0, 0xc0096c4c00, 0xc00b0c6000) /go/pkg/mod/github.com/json-iterator/go@v1.1.11/reflect_struct_encoder.go:158 &#43;0x3f4 github.com/json-iterator/go.(*OptionalEncoder).Encode(0xc002e9f570, 0xc006b18b38, 0xc00b0c6000) /go/pkg/mod/github.com/json-iterator/go@v1.1.11/reflect_optional.go:70 &#43;0xf4 github.com/json-iterator/go.(*onePtrEncoder).Encode(0xc002e9f580, 0xc0096c4c00, 0xc00b0c6000) /go/pkg/mod/github.com/json-iterator/go@v1.1.11/reflect.go:219 &#43;0x68 github.com/json-iterator/go.(*Stream).WriteVal(0xc00b0c6000, 0xb78d60, 0xc0096c4c00) /go/pkg/mod/github.com/json-iterator/go@v1.1.11/reflect.go:98 &#43;0x150 github.com/json-iterator/go.(*frozenConfig).Marshal(0xc00012c640, 0xb78d60, 0xc0096c4c00, 0x0, 0x0, 0x0, 0x0, 0x0) é¦–å…ˆæˆ‘åšä¿¡ä¸€æ¡ï¼Œå¼€æºçš„åŠ›é‡å€¼å¾—ä¿¡èµ–ã€‚å› æ­¤è€è®¸ç¬¬ä¸€æ³¢æ“ä½œå°±æ˜¯ï¼Œåˆ†æä¸šåŠ¡ä»£ç æ˜¯å¦æœ‰é€»è¾‘æ¼æ´ã€‚å¾ˆæ˜æ˜¾ï¼ŒåŒäº‹ä¹Ÿæ˜¯å€¼å¾—ä¿¡èµ–çš„ï¼Œå› æ­¤æœæ–­çŒœæµ‹æ˜¯æŸäº›æœªæ›¾è®¾æƒ³åˆ°çš„æ•°æ®è§¦å‘äº†è¾¹ç•Œæ¡ä»¶ã€‚æ¥ä¸‹æ¥å°±æ˜¯ä¿å­˜ç°åœºçš„å¸¸è§„æ“ä½œã€‚
å¦‚æ ‡é¢˜æ‰€è¯´ï¼Œè¿™æ˜¯å¶ç°çš„panicé—®é¢˜ï¼Œå› æ­¤æŒ‰ç…§ä¸Šé¢çš„åˆ†ç±»é‡‡ç”¨ç¬¦åˆå½“å‰æŠ€æœ¯æ ˆçš„æ–¹æ³•ä¿å­˜ç°åœºå³å¯ã€‚æ¥ä¸‹æ¥å°±æ˜¯åç­‰æ”¶è·çš„å­£èŠ‚ï¼Œè€Œè¿™ä¸€ç­‰å°±æ˜¯å¥½å¤šå¤©ã€‚ä¸­é—´æ•°æ¬¡æ”¶åˆ°å‘Šè­¦ï¼Œå´æ²¡æœ‰ç¬¦åˆé¢„æœŸçš„ç°åœºã€‚"><meta itemprop="datePublished" content="2021-11-23T12:20:38+08:00" />
<meta itemprop="dateModified" content="2021-11-23T12:20:38+08:00" />
<meta itemprop="wordCount" content="223">
<meta itemprop="keywords" content="Go," />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="ç»ˆäºè§£å†³äº†è¿™ä¸ªçº¿ä¸Šå¶ç°çš„panicé—®é¢˜"/>
<meta name="twitter:description" content="ä¸çŸ¥é“å…¶ä»–äººæ˜¯ä¸æ˜¯è¿™æ ·ï¼Œåæ­£è€è®¸æœ€æ€•å¬åˆ°çš„è¯å°±æ˜¯â€œå¶ç°â€ï¼Œè‡³äºåŸå› æˆ‘ä¸å¤šè¯´ï¼Œæ‡‚çš„éƒ½æ‡‚ã€‚
ä¸‹é¢ç›´æ¥çœ‹panicä¿¡æ¯ã€‚
runtime error: invalid memory address or nil pointer dereference panic(0xbd1c80, 0x1271710) /root/.go/src/runtime/panic.go:969 &#43;0x175 github.com/json-iterator/go.(*Stream).WriteStringWithHTMLEscaped(0xc00b0c6000, 0x0, 0x24) /go/pkg/mod/github.com/json-iterator/go@v1.1.11/stream_str.go:227 &#43;0x7b github.com/json-iterator/go.(*htmlEscapedStringEncoder).Encode(0x12b9250, 0xc0096c4c00, 0xc00b0c6000) /go/pkg/mod/github.com/json-iterator/go@v1.1.11/config.go:263 &#43;0x45 github.com/json-iterator/go.(*structFieldEncoder).Encode(0xc002e9c8d0, 0xc0096c4c00, 0xc00b0c6000) /go/pkg/mod/github.com/json-iterator/go@v1.1.11/reflect_struct_encoder.go:110 &#43;0x78 github.com/json-iterator/go.(*structEncoder).Encode(0xc002e9c9c0, 0xc0096c4c00, 0xc00b0c6000) /go/pkg/mod/github.com/json-iterator/go@v1.1.11/reflect_struct_encoder.go:158 &#43;0x3f4 github.com/json-iterator/go.(*structFieldEncoder).Encode(0xc002eac990, 0xc0096c4c00, 0xc00b0c6000) /go/pkg/mod/github.com/json-iterator/go@v1.1.11/reflect_struct_encoder.go:110 &#43;0x78 github.com/json-iterator/go.(*structEncoder).Encode(0xc002eacba0, 0xc0096c4c00, 0xc00b0c6000) /go/pkg/mod/github.com/json-iterator/go@v1.1.11/reflect_struct_encoder.go:158 &#43;0x3f4 github.com/json-iterator/go.(*OptionalEncoder).Encode(0xc002e9f570, 0xc006b18b38, 0xc00b0c6000) /go/pkg/mod/github.com/json-iterator/go@v1.1.11/reflect_optional.go:70 &#43;0xf4 github.com/json-iterator/go.(*onePtrEncoder).Encode(0xc002e9f580, 0xc0096c4c00, 0xc00b0c6000) /go/pkg/mod/github.com/json-iterator/go@v1.1.11/reflect.go:219 &#43;0x68 github.com/json-iterator/go.(*Stream).WriteVal(0xc00b0c6000, 0xb78d60, 0xc0096c4c00) /go/pkg/mod/github.com/json-iterator/go@v1.1.11/reflect.go:98 &#43;0x150 github.com/json-iterator/go.(*frozenConfig).Marshal(0xc00012c640, 0xb78d60, 0xc0096c4c00, 0x0, 0x0, 0x0, 0x0, 0x0) é¦–å…ˆæˆ‘åšä¿¡ä¸€æ¡ï¼Œå¼€æºçš„åŠ›é‡å€¼å¾—ä¿¡èµ–ã€‚å› æ­¤è€è®¸ç¬¬ä¸€æ³¢æ“ä½œå°±æ˜¯ï¼Œåˆ†æä¸šåŠ¡ä»£ç æ˜¯å¦æœ‰é€»è¾‘æ¼æ´ã€‚å¾ˆæ˜æ˜¾ï¼ŒåŒäº‹ä¹Ÿæ˜¯å€¼å¾—ä¿¡èµ–çš„ï¼Œå› æ­¤æœæ–­çŒœæµ‹æ˜¯æŸäº›æœªæ›¾è®¾æƒ³åˆ°çš„æ•°æ®è§¦å‘äº†è¾¹ç•Œæ¡ä»¶ã€‚æ¥ä¸‹æ¥å°±æ˜¯ä¿å­˜ç°åœºçš„å¸¸è§„æ“ä½œã€‚
å¦‚æ ‡é¢˜æ‰€è¯´ï¼Œè¿™æ˜¯å¶ç°çš„panicé—®é¢˜ï¼Œå› æ­¤æŒ‰ç…§ä¸Šé¢çš„åˆ†ç±»é‡‡ç”¨ç¬¦åˆå½“å‰æŠ€æœ¯æ ˆçš„æ–¹æ³•ä¿å­˜ç°åœºå³å¯ã€‚æ¥ä¸‹æ¥å°±æ˜¯åç­‰æ”¶è·çš„å­£èŠ‚ï¼Œè€Œè¿™ä¸€ç­‰å°±æ˜¯å¥½å¤šå¤©ã€‚ä¸­é—´æ•°æ¬¡æ”¶åˆ°å‘Šè­¦ï¼Œå´æ²¡æœ‰ç¬¦åˆé¢„æœŸçš„ç°åœºã€‚"/>







    <meta property="article:published_time" content="2021-11-23 12:20:38 &#43;0800 CST" />








    </head>

    <body class="">
        <div class="container">
            <header class="header">
    <span class="header__inner">
        <a href="https://isites.gitlab.io/gopher/" style="text-decoration: none;">
    <div class="logo">
        
            <span class="logo__mark">GopheræŒ‡åŒ—</span>
            <span class="logo__text"></span>
            <span class="logo__cursor" style=
                  "
                   
                   ">
            </span>
        
    </div>
</a>


        <span class="header__right">
             
            <span class="theme-toggle unselectable"><svg class="theme-toggler" width="24" height="24" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
  <path d="M22 41C32.4934 41 41 32.4934 41 22C41 11.5066 32.4934 3 22
  3C11.5066 3 3 11.5066 3 22C3 32.4934 11.5066 41 22 41ZM7 22C7
  13.7157 13.7157 7 22 7V37C13.7157 37 7 30.2843 7 22Z"/>
</svg>
</span>
        </span>
    </span>
</header>


            <div class="content">
                
  <main class="post">

    <div class="post-info">
      <p>
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-clock">
          <circle cx="12" cy="12" r="10"></circle>
          <polyline points="12 6 12 12 16 14"></polyline>
        </svg>
        2 minutes

        
      </p>
    </div>

    <article>
      <h1 class="post-title">
        <a href="https://isites.gitlab.io/gopher/timeline/defer-sync-pool/">ç»ˆäºè§£å†³äº†è¿™ä¸ªçº¿ä¸Šå¶ç°çš„panicé—®é¢˜</a>
      </h1>
        <hr />
        <aside id="toc">
          <div class="toc-title">Table of Contents</div>
          <nav id="TableOfContents"></nav>
        </aside>
        <hr />

      

      <div class="post-content">
        <p>ä¸çŸ¥é“å…¶ä»–äººæ˜¯ä¸æ˜¯è¿™æ ·ï¼Œåæ­£è€è®¸æœ€æ€•å¬åˆ°çš„è¯å°±æ˜¯â€œå¶ç°â€ï¼Œè‡³äºåŸå› æˆ‘ä¸å¤šè¯´ï¼Œæ‡‚çš„éƒ½æ‡‚ã€‚</p>
<p>ä¸‹é¢ç›´æ¥çœ‹<code>panic</code>ä¿¡æ¯ã€‚</p>
<pre tabindex="0"><code>runtime error: invalid memory address or nil pointer dereference

panic(0xbd1c80, 0x1271710)
        /root/.go/src/runtime/panic.go:969 +0x175
github.com/json-iterator/go.(*Stream).WriteStringWithHTMLEscaped(0xc00b0c6000, 0x0, 0x24)
        /go/pkg/mod/github.com/json-iterator/go@v1.1.11/stream_str.go:227 +0x7b
github.com/json-iterator/go.(*htmlEscapedStringEncoder).Encode(0x12b9250, 0xc0096c4c00, 0xc00b0c6000)
        /go/pkg/mod/github.com/json-iterator/go@v1.1.11/config.go:263 +0x45
github.com/json-iterator/go.(*structFieldEncoder).Encode(0xc002e9c8d0, 0xc0096c4c00, 0xc00b0c6000)
        /go/pkg/mod/github.com/json-iterator/go@v1.1.11/reflect_struct_encoder.go:110 +0x78
github.com/json-iterator/go.(*structEncoder).Encode(0xc002e9c9c0, 0xc0096c4c00, 0xc00b0c6000)
        /go/pkg/mod/github.com/json-iterator/go@v1.1.11/reflect_struct_encoder.go:158 +0x3f4
github.com/json-iterator/go.(*structFieldEncoder).Encode(0xc002eac990, 0xc0096c4c00, 0xc00b0c6000)
        /go/pkg/mod/github.com/json-iterator/go@v1.1.11/reflect_struct_encoder.go:110 +0x78
github.com/json-iterator/go.(*structEncoder).Encode(0xc002eacba0, 0xc0096c4c00, 0xc00b0c6000)
        /go/pkg/mod/github.com/json-iterator/go@v1.1.11/reflect_struct_encoder.go:158 +0x3f4
github.com/json-iterator/go.(*OptionalEncoder).Encode(0xc002e9f570, 0xc006b18b38, 0xc00b0c6000)
        /go/pkg/mod/github.com/json-iterator/go@v1.1.11/reflect_optional.go:70 +0xf4
github.com/json-iterator/go.(*onePtrEncoder).Encode(0xc002e9f580, 0xc0096c4c00, 0xc00b0c6000)
        /go/pkg/mod/github.com/json-iterator/go@v1.1.11/reflect.go:219 +0x68
github.com/json-iterator/go.(*Stream).WriteVal(0xc00b0c6000, 0xb78d60, 0xc0096c4c00)
        /go/pkg/mod/github.com/json-iterator/go@v1.1.11/reflect.go:98 +0x150
github.com/json-iterator/go.(*frozenConfig).Marshal(0xc00012c640, 0xb78d60, 0xc0096c4c00, 0x0, 0x0, 0x0, 0x0, 0x0)
</code></pre><p>é¦–å…ˆæˆ‘åšä¿¡ä¸€æ¡ï¼Œå¼€æºçš„åŠ›é‡å€¼å¾—ä¿¡èµ–ã€‚å› æ­¤è€è®¸ç¬¬ä¸€æ³¢æ“ä½œå°±æ˜¯ï¼Œåˆ†æä¸šåŠ¡ä»£ç æ˜¯å¦æœ‰é€»è¾‘æ¼æ´ã€‚å¾ˆæ˜æ˜¾ï¼ŒåŒäº‹ä¹Ÿæ˜¯å€¼å¾—ä¿¡èµ–çš„ï¼Œå› æ­¤æœæ–­çŒœæµ‹æ˜¯æŸäº›æœªæ›¾è®¾æƒ³åˆ°çš„æ•°æ®è§¦å‘äº†è¾¹ç•Œæ¡ä»¶ã€‚æ¥ä¸‹æ¥å°±æ˜¯ä¿å­˜ç°åœºçš„å¸¸è§„æ“ä½œã€‚</p>
<p><img src="https://note.youdao.com/yws/api/personal/file/WEB55378a70dcf723b1617068ca71946b42?method=download&amp;shareKey=8271f11fe3137da9849495f3fe9f899e" alt=""></p>
<p>å¦‚æ ‡é¢˜æ‰€è¯´ï¼Œè¿™æ˜¯å¶ç°çš„panicé—®é¢˜ï¼Œå› æ­¤æŒ‰ç…§ä¸Šé¢çš„åˆ†ç±»é‡‡ç”¨ç¬¦åˆå½“å‰æŠ€æœ¯æ ˆçš„æ–¹æ³•ä¿å­˜ç°åœºå³å¯ã€‚æ¥ä¸‹æ¥å°±æ˜¯åç­‰æ”¶è·çš„å­£èŠ‚ï¼Œè€Œè¿™ä¸€ç­‰å°±æ˜¯å¥½å¤šå¤©ã€‚ä¸­é—´æ•°æ¬¡æ”¶åˆ°å‘Šè­¦ï¼Œå´æ²¡æœ‰ç¬¦åˆé¢„æœŸçš„ç°åœºã€‚</p>
<p>è¿™ä¸ªæ—¶å€™æˆ‘ä¸ä»…ä¸æ…Œï¼Œç”šè‡³è¿˜æœ‰ç‚¹å°æ¿€åŠ¨ã€‚æŸæŸæ›¾æ›°ï¼šâ€œè¦æ•¢äºè´¨ç–‘ï¼Œæ•¢äºæŒ‘æˆ˜æƒå¨â€ï¼Œä¸€å¿µè‡³æ­¤ä¾¿ä¸€å‘ä¸å¯æ”¶æ‹¾ï¼Œæˆ‘è€è®¸åˆè¦ä¸ºå¼€æºäº‹ä¸šåšå‡ºè´¡çŒ®äº†å˜›ï¼è¯´å¹²å°±æ•¢å¹²ï¼Œæ€€ç€å°å¿ƒæ€å¼€å§‹é˜…è¯»<code>json-iterator</code>çš„æºç ã€‚</p>
<p>åˆšå¼€å§‹ç ”è¯»æˆ‘ä¾¿æ˜ç™½äº†ä¸€ä¸ªé“ç†ï¼Œ â€œå½“ä¸Šå¸å…³äº†è¿™æ‰‡é—¨ï¼Œä¸€å®šä¼šä¸ºä½ æ‰“å¼€å¦ä¸€æ‰‡é—¨â€è¿™å¥è¯æ˜¯éª—äººçš„ã€‚è€è®¸åªè§‰å¾—ä¸Šå¸ä¸ä»…å…³ä¸Šäº†æ‰€æœ‰çš„é—¨ç”šè‡³è¿˜å…³ä¸Šäº†æ‰€æœ‰çš„çª—ã€‚ä¸‹é¢æˆ‘ä»¬çœ‹çœ‹ä»–åˆ°åº•æ˜¯æ€ä¹ˆå…³é—¨çš„ã€‚</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">cfg</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">frozenConfig</span>) <span style="color:#a6e22e">Marshal</span>(<span style="color:#a6e22e">v</span> <span style="color:#66d9ef">interface</span>{}) ([]<span style="color:#66d9ef">byte</span>, <span style="color:#66d9ef">error</span>) {
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">stream</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">cfg</span>.<span style="color:#a6e22e">BorrowStream</span>(<span style="color:#66d9ef">nil</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">defer</span> <span style="color:#a6e22e">cfg</span>.<span style="color:#a6e22e">ReturnStream</span>(<span style="color:#a6e22e">stream</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">stream</span>.<span style="color:#a6e22e">WriteVal</span>(<span style="color:#a6e22e">v</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">stream</span>.<span style="color:#a6e22e">Error</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">return</span> <span style="color:#66d9ef">nil</span>, <span style="color:#a6e22e">stream</span>.<span style="color:#a6e22e">Error</span>
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">result</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">stream</span>.<span style="color:#a6e22e">Buffer</span>()
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">copied</span> <span style="color:#f92672">:=</span> make([]<span style="color:#66d9ef">byte</span>, len(<span style="color:#a6e22e">result</span>))
</span></span><span style="display:flex;"><span>	copy(<span style="color:#a6e22e">copied</span>, <span style="color:#a6e22e">result</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">return</span> <span style="color:#a6e22e">copied</span>, <span style="color:#66d9ef">nil</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// WriteVal copy the go interface into underlying JSON, same as json.Marshal
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">stream</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">Stream</span>) <span style="color:#a6e22e">WriteVal</span>(<span style="color:#a6e22e">val</span> <span style="color:#66d9ef">interface</span>{}) {
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> <span style="color:#66d9ef">nil</span> <span style="color:#f92672">==</span> <span style="color:#a6e22e">val</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">stream</span>.<span style="color:#a6e22e">WriteNil</span>()
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">return</span>
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">// çœç•¥å…¶ä»–ä»£ç 
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>}
</span></span></code></pre></div><p>æ ¹æ®panicæ ˆçŸ¥é“æ˜¯å› ä¸ºç©ºæŒ‡é’ˆé€ æˆäº†panicï¼Œè€Œ<code>(*frozenConfig).Marshal</code>å‡½æ•°å†…éƒ¨å·²ç»åšäº†éç©ºåˆ¤æ–­ã€‚åˆ°æ­¤ï¼Œè€è®¸çœŸçš„å·²ç»åˆ«æ— ä»–æ³•åªå¾—æˆ˜ç•¥æ€§æ”¾å¼ƒè§£å†³æ­¤æ¬¡panicã€‚æ¯•ç«Ÿï¼Œè¿™ä¸ªå½±å“ä¹Ÿæ²¡é‚£ä¹ˆå¤§ï¼Œè€Œä¸”ç¨‹åºå‘˜å“ªæœ‰ä¿®çš„å®Œçš„bugå‘¢ã€‚ç»è¿‡è¿™æ ·ä¸€ç•ªå®‰æ…°ï¼Œå¿ƒé‡Œç¡®å®å®¹æ˜“æ¥å—å¤šäº†ã€‚</p>
<p>äº‹å®ä¸Šï¼Œåœ¨è¾ƒé•¿ä¸€æ®µæ—¶é—´å†…æˆ‘éƒ½æœ‰æ„è¯†åœ°å¿½ç•¥è¿™ä¸ªé—®é¢˜ï¼Œæ¯•ç«Ÿæ²¡æœ‰æ‰¾åˆ°é—®é¢˜çš„æ ¹å› ã€‚è¿™ä¸ªé—®é¢˜åœ¨çº¿ä¸Šä¸€ç›´æŒç»­åˆ°ä¸€ä¸ªè¯´ä¸ä¸Šæ¥ä»€ä¹ˆæ—¥å­çš„æ—¥å­ï¼Œæ€»è€Œè¨€ä¹‹å°±æ˜¯å…´è‡´æ¥äº†ï¼Œæˆ‘å†æ¬¡çœ‹äº†ä¸¤çœ¼ï¼Œè€Œè¿™ä¸¤çœ¼å¾ˆå…³é”®ï¼</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">doReq</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">req</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">paramsPool</span>.<span style="color:#a6e22e">Get</span>().(<span style="color:#f92672">*</span><span style="color:#a6e22e">model</span>.<span style="color:#a6e22e">Params</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// defer 1
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">defer</span> <span style="color:#66d9ef">func</span>() {
</span></span><span style="display:flex;"><span>    	<span style="color:#a6e22e">reqBytes</span>, <span style="color:#a6e22e">_</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">json</span>.<span style="color:#a6e22e">Marshal</span>(<span style="color:#a6e22e">req</span>)
</span></span><span style="display:flex;"><span>    	<span style="color:#75715e">// çœç•¥å…¶ä»–æ‰“å°æ—¥å¿—çš„ä»£ç 
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    }()
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// defer 2
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">defer</span> <span style="color:#a6e22e">paramsPool</span>.<span style="color:#a6e22e">Put</span>(<span style="color:#a6e22e">req</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// reqåˆå§‹åŒ–ä»¥åŠå‘èµ·è¯·æ±‚å’Œå…¶ä»–æ“ä½œ
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>}
</span></span></code></pre></div><blockquote>
<p><strong>æ³¨ï¼š</strong></p>
<ol>
<li>ä¸Šè¿°ä»£ç å˜é‡å‘½åå·²ç»è¢«è€è®¸é€šç”¨åŒ–å¤„ç†ã€‚</li>
<li>é¡¹ç›®ä¸­å®é™…ä»£ç è¿œæ¯”ä¸Šè¿°å¤æ‚ï¼Œä½†ä¸Šè¿°ä»£ç ä¾æ—§æ˜¯é€ æˆæœ¬æ¬¡é—®é¢˜çš„æœ€å°åŸå‹ã€‚</li>
</ol>
</blockquote>
<p>ä¸Šé¢ä»£ç ä¸­<code>paramsPool</code>æ˜¯<code>sync.Pool</code>ç±»å‹çš„å˜é‡ï¼Œè€Œ<code>sync.Pool</code>æƒ³å¿…å¤§å®¶éƒ½å¾ˆç†Ÿæ‚‰ã€‚<code>sync.Pool</code>æ˜¯ä¸ºäº†å¤ç”¨å·²ç»ä½¿ç”¨è¿‡çš„å¯¹è±¡(åç¨‹å®‰å…¨)ï¼Œå‡å°‘å†…å­˜åˆ†é…å’Œé™ä½GCå‹åŠ›ã€‚</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">test</span> <span style="color:#66d9ef">struct</span> {
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">a</span> <span style="color:#66d9ef">string</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> <span style="color:#a6e22e">sp</span> = <span style="color:#a6e22e">sync</span>.<span style="color:#a6e22e">Pool</span>{
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">New</span>: <span style="color:#66d9ef">func</span>() <span style="color:#66d9ef">interface</span>{} {
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">return</span> new(<span style="color:#a6e22e">test</span>)
</span></span><span style="display:flex;"><span>	},
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">main</span>() {
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">t</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">sp</span>.<span style="color:#a6e22e">Get</span>().(<span style="color:#f92672">*</span><span style="color:#a6e22e">test</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#a6e22e">unsafe</span>.<span style="color:#a6e22e">Pointer</span>(<span style="color:#a6e22e">t</span>))
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">sp</span>.<span style="color:#a6e22e">Put</span>(<span style="color:#a6e22e">t</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">t1</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">sp</span>.<span style="color:#a6e22e">Get</span>().(<span style="color:#f92672">*</span><span style="color:#a6e22e">test</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">t2</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">sp</span>.<span style="color:#a6e22e">Get</span>().(<span style="color:#f92672">*</span><span style="color:#a6e22e">test</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#a6e22e">unsafe</span>.<span style="color:#a6e22e">Pointer</span>(<span style="color:#a6e22e">t1</span>), <span style="color:#a6e22e">unsafe</span>.<span style="color:#a6e22e">Pointer</span>(<span style="color:#a6e22e">t2</span>))
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p><img src="https://note.youdao.com/yws/api/personal/file/WEB30a2f5c4b11b2974a9dacfaa7afc06a8?method=download&amp;shareKey=c81b700ce8b721b4d27062c5f07ef4e3" alt=""></p>
<p>æ ¹æ®ä¸Šè¿°ä»£ç å’Œè¾“å‡ºç»“æœçŸ¥ï¼Œ<code>t1</code>å˜é‡å’Œ<code>t</code>å˜é‡åœ°å€ä¸€è‡´ï¼Œå› æ­¤ä»–ä»¬æ˜¯å¤ç”¨å¯¹è±¡ã€‚æ­¤æ—¶å†å›é¡¾ä¸Šé¢çš„<code>doReq</code>å‡½æ•°å°±å¾ˆå®¹æ˜“å‘ç°é—®é¢˜çš„æ ¹å› ã€‚</p>
<p><code>defer 2</code>å’Œ<code>defer 1</code>é¡ºåºåäº†ï¼ï¼ï¼</p>
<p><code>defer 2</code>å’Œ<code>defer 1</code>é¡ºåºåäº†ï¼ï¼ï¼</p>
<p><code>defer 2</code>å’Œ<code>defer 1</code>é¡ºåºåäº†ï¼ï¼ï¼</p>
<p><code>sync.Pool</code>æä¾›çš„<code>Get</code>å’Œ<code>Put</code>æ–¹æ³•æ˜¯åç¨‹å®‰å…¨çš„ï¼Œä½†æ˜¯é«˜å¹¶å‘è°ƒç”¨<code>doReq</code>å‡½æ•°æ—¶<code>json.Marshal(req)</code>å’Œè¯·æ±‚åˆå§‹åŒ–ä¼šå­˜åœ¨å¹¶å‘é—®é¢˜ï¼Œææœ‰å¯èƒ½å¼•èµ·panicçš„å¹¶å‘è°ƒç”¨æ—¶é—´çº¿å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚</p>
<p><img src="https://note.youdao.com/yws/api/personal/file/WEBab9220ec9c5c75ac59489fd69039e269?method=download&amp;shareKey=e962344375d221450b80e4b1d6306aec" alt=""></p>
<p>æ—¢ç„¶å·²ç»æ‰¾åˆ°åŸå› ï¼Œè§£å†³èµ·æ¥å°±å®¹æ˜“å¤šäº†ï¼Œåªéœ€è°ƒæ•´<code>defer 2</code>å’Œ<code>defer 1</code>çš„è°ƒç”¨é¡ºåºå³å¯ã€‚è€è®¸å°†ä¿®æ”¹åçš„ä»£ç å‘å¸ƒåˆ°çº¿ä¸Šåä¹Ÿç¡®å®å†æ²¡æœ‰å‡ºç°panicã€‚é€ æˆè¿™æ¬¡äº‹æ•…çš„æ ¹æœ¬åŸå› æ˜¯ä¸€ä¸ªå¾®ä¹å…¶å¾®çš„ç»†èŠ‚ï¼Œæ‰€ä»¥æˆ‘ä»¬å¹³æ—¶åœ¨å¼€å‘ä¸­è¿˜æ˜¯è¦è°¨æ…åŠ è°¨æ…ï¼Œé¿å…å› ä¸ºè¿™ç§å°ç™½é”™è¯¯é€ æˆä¸å¯æŒ½å›çš„æŸå¤±ã€‚å¦å¤–ä¸€ä¸ªç»éªŒä¹‹è°ˆå°±æ˜¯ï¼Œå¼€å‘å’ŒæŸ¥é—®é¢˜æ—¶å°½é‡ä¸è¦é’»ç‰›è§’å°–ï¼Œé€‚å½“çš„åœé¡¿å¯èƒ½ä¼šæœ‰æ„æƒ³ä¸åˆ°çš„å¥‡æ•ˆã€‚</p>
<p>æœ€åï¼Œè¡·å¿ƒå¸Œæœ›æœ¬æ–‡èƒ½å¤Ÿå¯¹å„ä½è¯»è€…æœ‰ä¸€å®šçš„å¸®åŠ©ã€‚</p>
<p>ã€å…³æ³¨å…¬ä¼—å·ã€‘</p>
<p><img src="https://note.youdao.com/yws/api/personal/file/WEBa3ee67b2b867e98cb5c587f4adfa6801?method=download&amp;shareKey=0fbb95d0aec6170b854e7b890d50d559" alt=""></p>

      </div>
    </article>

    <hr />

    <div class="post-info">
        <p>
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag meta-icon">
            <path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path>
            <line x1="7" y1="7" x2="7" y2="7"></line>
          </svg><span class="tag"><a href="https://isites.gitlab.io/gopher/tags/go/">Go</a></span>
        </p>

      <p>
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file-text">
          <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
          <polyline points="14 2 14 8 20 8"></polyline>
          <line x1="16" y1="13" x2="8" y2="13"></line>
          <line x1="16" y1="17" x2="8" y2="17"></line>
          <polyline points="10 9 9 9 8 9"></polyline>
        </svg>
        223 Words
      </p>

      <p>
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-calendar">
          <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
          <line x1="16" y1="2" x2="16" y2="6"></line>
          <line x1="8" y1="2" x2="8" y2="6"></line>
          <line x1="3" y1="10" x2="21" y2="10"></line>
        </svg>
        2021-11-23 12:20 &#43;0800
      </p>
 
    </div>

    
      <div class="pagination">
        <div class="pagination__title">
          <span class="pagination__title-h"></span>
          <hr />
        </div>

        <div class="pagination__buttons">
          
            <span class="button previous">
              <a href="https://isites.gitlab.io/gopher/timeline/money/">
                <span class="button__icon">â†</span>
                <span class="button__text">æ¢è®¨ç³»ç»Ÿä¸­ğŸ’°é’±çš„ç²¾åº¦é—®é¢˜</span>
              </a>
            </span>
          

          
            <span class="button next">
              <a href="https://isites.gitlab.io/gopher/timeline/ad-msvv/">
                <span class="button__text">æµ…è°ˆåœ¨çº¿å¹¿å‘Šåˆ†é…ç­–ç•¥</span>
                <span class="button__icon">â†’</span>
              </a>
            </span>
          
        </div>
      </div>
    


    

  </main>

            </div>

            
                <footer class="footer">
    <div class="footer__inner">
        <div class="footer__content">
            <span>&copy; 2022</span>
            
             
        </div>
    </div> 
</footer>
<script type="text/javascript">
    $(function(){

  window.sr = ScrollReveal();

  if ($(window).width() < 768) {

    if ($('.timeline-content').hasClass('js--fadeInLeft')) {
        $('.timeline-content').removeClass('js--fadeInLeft').addClass('js--fadeInRight');
    }

    sr.reveal('.js--fadeInRight', {
        origin: 'right',
        distance: '300px',
        easing: 'ease-in-out',
        duration: 800,
      });

  } else {
    
    sr.reveal('.js--fadeInLeft', {
        origin: 'left',
        distance: '300px',
          easing: 'ease-in-out',
        duration: 800,
      });

      sr.reveal('.js--fadeInRight', {
        origin: 'right',
        distance: '300px',
        easing: 'ease-in-out',
        duration: 800,
      });

  }
  
  sr.reveal('.js--fadeInLeft', {
        origin: 'left',
        distance: '300px',
          easing: 'ease-in-out',
        duration: 800,
      });

      sr.reveal('.js--fadeInRight', {
        origin: 'right',
        distance: '300px',
        easing: 'ease-in-out',
        duration: 800,
      });


});

</script>
            
        </div>

        




<script type="text/javascript" src="/gopher/bundle.min.e2a9675ced043d06ad6d3f13fafb0203d96c89eb2484878d5eb89d6da19559cbed55fb05ca9eae7be1e975cab83e3b2a1193afc357019620a509327c5a6a9c0f.js" integrity="sha512-4qlnXO0EPQatbT8T&#43;vsCA9lsieskhIeNXridbaGVWcvtVfsFyp6ue&#43;Hpdcq4PjsqEZOvw1cBliClCTJ8WmqcDw=="></script>


    
        <script src="/js/bd-hm.js"></script>
    


    </body>
</html>
